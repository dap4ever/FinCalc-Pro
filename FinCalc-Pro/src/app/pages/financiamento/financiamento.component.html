<section class="space-y-6">
  <h1 class="text-2xl font-semibold text-[#1F2937]">Calculadora de Financiamento Imobili√°rio</h1>
  <p class="text-gray-700">Simule parcelas, juros e valor total do financiamento</p>

  <form
    class="grid md:grid-cols-2 gap-6 bg-white p-6 rounded-2xl shadow-sm border border-gray-200"
    (ngSubmit)="simular()"
  >
    <div>
      <label class="block text-sm text-gray-600 mb-1">Banco</label>
      <div class="relative">
        <button
          type="button"
          (click)="toggleDropdown()"
          class="w-full rounded-xl border border-gray-300 px-3 py-2.5 bg-white text-left flex items-center justify-between hover:border-[#2563EB] transition-colors"
        >
          <div class="flex items-center gap-3">
            <img
              *ngIf="getBancoSelecionado()?.logo"
              [src]="getBancoSelecionado()?.logo"
              [alt]="bancoSelecionado"
              class="h-6 w-auto object-contain p-1 bg-white rounded"
            />
            <span class="text-gray-900">{{ bancoSelecionado || 'Selecione um banco' }}</span>
          </div>
          <svg
            class="w-5 h-5 text-gray-400"
            [class.rotate-180]="dropdownAberto"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </button>

        <div
          *ngIf="dropdownAberto"
          class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-xl shadow-lg max-h-80 overflow-auto"
        >
          <button
            *ngFor="let banco of bancos"
            type="button"
            (click)="selecionarBanco(banco.nome)"
            class="w-full px-3 py-3 text-left hover:bg-[#F9FAFB] flex items-center gap-3 transition-colors"
            [class.bg-blue-50]="banco.nome === bancoSelecionado"
          >
            <img
              *ngIf="banco.logo"
              [src]="banco.logo"
              [alt]="banco.nome"
              class="h-6 w-auto object-contain p-1 bg-gray-50 rounded"
              onerror="this.style.display = 'none'"
            />
            <div class="flex-1">
              <div class="font-medium text-gray-900">{{ banco.nome }}</div>
              <div *ngIf="banco.taxa > 0" class="text-xs text-gray-500">
                {{ banco.taxa.toFixed(2) }}% a.a.
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Taxa de Juros Anual (%)</label>
      <div class="flex gap-2">
        <input
          type="number"
          step="0.01"
          [(ngModel)]="jurosAnual"
          name="jurosAnual"
          class="flex-1 rounded-xl border border-gray-300 px-3 py-2"
          placeholder="Ex: 9.5%"
        />
        <button
          type="button"
          *ngIf="bancoSelecionado === 'Caixa Econ√¥mica Federal'"
          (click)="abrirCaixaModal()"
          title="Ver linhas de cr√©dito da Caixa"
          class="px-3 py-2 bg-[#2563EB] text-white rounded-xl hover:bg-[#1E4FD7] transition-colors font-semibold"
        >
          ‚ÑπÔ∏è
        </button>
      </div>
      <div class="mt-1 text-xs text-gray-500" *ngIf="!carregandoTaxas">
        Taxa m√©dia atual:
        <strong class="text-[#2563EB]">{{ taxaSugerida.toFixed(2) }}% a.a.</strong>
        <button
          type="button"
          (click)="aplicarTaxaSugerida()"
          class="ml-2 text-[#2563EB] hover:underline"
        >
          Aplicar
        </button>
      </div>
      <div class="mt-1 text-xs text-gray-400" *ngIf="carregandoTaxas">Carregando taxa atual...</div>
      <div class="mt-1 text-xs text-green-600" *ngIf="bancoSelecionadoNome">
        ‚úì {{ bancoSelecionadoNome }} selecionado
      </div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Valor do Im√≥vel</label>
      <div class="relative">
        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-600 font-medium">R$</span>
        <input
          type="text"
          appCurrencyMask
          [(ngModel)]="valorImovel"
          name="valorImovel"
          (ngModelChange)="onValorImovelChange()"
          class="w-full rounded-xl border border-gray-300 pl-12 pr-3 py-2"
          placeholder="300.000,00"
        />
      </div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Valor da Entrada</label>
      <div class="relative">
        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-600 font-medium">R$</span>
        <input
          type="text"
          appCurrencyMask
          [(ngModel)]="entrada"
          name="entrada"
          class="w-full rounded-xl border border-gray-300 pl-12 pr-3 py-2"
          placeholder="60.000,00"
        />
      </div>
      <div class="mt-1 text-xs text-gray-500" *ngIf="percentualEntradaMinima > 0">
        Entrada m√≠nima: <strong class="text-[#2563EB]">{{ percentualEntradaMinima }}%</strong> ({{
          entradaMinimaRecomendada | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR'
        }})
      </div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Prazo (anos)</label>
      <input
        type="number"
        [(ngModel)]="prazoAnos"
        name="prazoAnos"
        (focus)="$event.target.select()"
        class="w-full rounded-xl border border-gray-300 px-3 py-2"
        placeholder="Ex: 30 anos"
      />
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Sistema de Amortiza√ß√£o</label>
      <select
        [(ngModel)]="sistema"
        name="sistema"
        class="w-full rounded-xl border border-gray-300 px-3 py-2"
      >
        <option value="SAC">SAC</option>
        <option value="PRICE">PRICE</option>
      </select>
    </div>

    <div class="md:col-span-2 flex justify-end">
      <button
        type="submit"
        class="rounded-xl bg-[#2563EB] text-white px-5 py-3 shadow-md hover:bg-[#1E4FD7]"
      >
        Simular
      </button>
    </div>
  </form>

  <div *ngIf="resultado as r" class="mt-8">
    <div class="rounded-2xl bg-white p-8 shadow-sm border border-gray-200 max-w-2xl">
      <h3 class="text-xl font-semibold mb-6 text-[#1F2937] pb-3 border-b-2 border-gray-200">
        Resultado da Simula√ß√£o
      </h3>
      <ul class="space-y-5">
        <li class="flex justify-between items-center py-3">
          <span class="text-base text-gray-600">Valor da Parcela Inicial</span>
          <strong class="text-xl text-[#1F2937]">{{ r.parcelaInicial }}</strong>
        </li>
        <li class="flex justify-between items-center py-3 bg-gray-50 -mx-4 px-4 rounded-lg">
          <span class="text-base text-gray-600">Valor da Parcela Final</span>
          <strong class="text-xl text-[#1F2937]">{{ r.parcelaFinal }}</strong>
        </li>
        <li class="flex justify-between items-center py-3">
          <span class="text-base text-gray-600">Valor Total Pago</span>
          <strong class="text-xl text-[#1F2937]">{{ r.valorTotalPago }}</strong>
        </li>
        <li class="flex justify-between items-center py-3 bg-gray-50 -mx-4 px-4 rounded-lg">
          <span class="text-base text-gray-600">Total de Juros</span>
          <strong class="text-xl text-[#1F2937]">{{ r.totalJuros }}</strong>
        </li>
      </ul>
    </div>

    <!-- An√∫ncio ap√≥s resultado -->
    <div
      class="mt-8 rounded-2xl bg-white p-8 shadow-sm border-2 border-dashed border-gray-300 max-w-2xl flex items-center justify-center min-h-[300px]"
    >
      <div class="text-center">
        <div class="text-5xl mb-3">üì¢</div>
        <p class="text-gray-500 text-lg">Espa√ßo para An√∫ncio</p>
        <p class="text-gray-400 text-sm mt-2">Ap√≥s resultado da simula√ß√£o</p>
      </div>
    </div>
  </div>
</section>

<!-- Conte√∫do Educacional -->
<section class="mt-16 space-y-12">
  <!-- O que √© Financiamento Imobili√°rio -->
  <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl p-8 border border-gray-200">
    <h2 class="text-3xl font-bold text-[#1F2937] mb-6">O que √© Financiamento Imobili√°rio?</h2>
    <div class="prose max-w-none text-gray-700 leading-relaxed space-y-4">
      <p>
        O financiamento imobili√°rio √© um empr√©stimo de longo prazo concedido por bancos e
        institui√ß√µes financeiras para a compra de im√≥veis residenciais ou comerciais. O im√≥vel
        financiado serve como garantia (aliena√ß√£o fiduci√°ria), o que permite taxas de juros mais
        baixas em compara√ß√£o com outros tipos de cr√©dito.
      </p>
      <p>
        No Brasil, os principais programas de financiamento s√£o o
        <strong>Sistema Financeiro da Habita√ß√£o (SFH)</strong>, destinado a im√≥veis de at√© R$ 1,5
        milh√£o com condi√ß√µes especiais, e o
        <strong>Sistema de Financiamento Imobili√°rio (SFI)</strong>, para im√≥veis acima desse valor.
      </p>
    </div>
  </div>

  <!-- SAC vs PRICE -->
  <div class="bg-gradient-to-br from-green-50 to-white rounded-2xl p-8 border border-gray-200">
    <h2 class="text-3xl font-bold text-[#1F2937] mb-6">SAC vs PRICE: Qual escolher?</h2>
    <div class="grid md:grid-cols-2 gap-8">
      <div class="space-y-4">
        <h3 class="text-2xl font-bold text-[#1F2937]">Sistema SAC</h3>
        <p class="text-gray-700 leading-relaxed">
          No <strong>Sistema de Amortiza√ß√£o Constante</strong>, a amortiza√ß√£o (pagamento do
          principal) √© fixa e os juros diminuem mensalmente. Isso resulta em:
        </p>
        <ul class="list-disc list-inside space-y-2 text-gray-700">
          <li><strong>Parcelas decrescentes:</strong> come√ßam mais altas e v√£o diminuindo</li>
          <li><strong>Menor custo total:</strong> voc√™ paga menos juros ao final</li>
          <li><strong>Amortiza√ß√£o mais r√°pida:</strong> o saldo devedor cai mais r√°pido</li>
        </ul>
        <div class="bg-blue-100 border-l-4 border-blue-500 p-4 mt-4">
          <p class="text-sm text-blue-900">
            <strong>Ideal para:</strong> Quem tem renda suficiente para pagar parcelas iniciais mais
            altas e quer economizar no total de juros.
          </p>
        </div>
      </div>

      <div class="space-y-4">
        <h3 class="text-2xl font-bold text-[#1F2937]">Tabela PRICE</h3>
        <p class="text-gray-700 leading-relaxed">
          Na <strong>Tabela PRICE</strong>, as parcelas s√£o fixas do in√≠cio ao fim do contrato. Nos
          primeiros anos, a maior parte da parcela √© composta por juros:
        </p>
        <ul class="list-disc list-inside space-y-2 text-gray-700">
          <li><strong>Parcelas fixas:</strong> mesmo valor do in√≠cio ao fim</li>
          <li><strong>Previsibilidade:</strong> mais f√°cil de planejar o or√ßamento</li>
          <li><strong>Custo total maior:</strong> voc√™ paga mais juros ao final</li>
        </ul>
        <div class="bg-green-100 border-l-4 border-green-500 p-4 mt-4">
          <p class="text-sm text-green-900">
            <strong>Ideal para:</strong> Quem prefere estabilidade no or√ßamento mensal e n√£o quer se
            comprometer com parcelas iniciais altas.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Dicas para Financiamento -->
  <div class="bg-gradient-to-br from-orange-50 to-white rounded-2xl p-8 border border-gray-200">
    <h2 class="text-3xl font-bold text-[#1F2937] mb-6">Dicas para obter o melhor financiamento</h2>
    <div class="space-y-6">
      <div class="flex gap-4 items-start">
        <div class="text-3xl flex-shrink-0">üí∞</div>
        <div>
          <h3 class="text-xl font-bold text-[#1F2937] mb-2">D√™ a maior entrada poss√≠vel</h3>
          <p class="text-gray-700 leading-relaxed">
            Quanto maior a entrada, menor o valor financiado e, consequentemente, menores ser√£o os
            juros pagos. Al√©m disso, uma entrada acima de 20% pode garantir taxas melhores e maior
            chance de aprova√ß√£o.
          </p>
        </div>
      </div>

      <div class="flex gap-4 items-start">
        <div class="text-3xl flex-shrink-0">üîç</div>
        <div>
          <h3 class="text-xl font-bold text-[#1F2937] mb-2">Compare taxas de diferentes bancos</h3>
          <p class="text-gray-700 leading-relaxed">
            A taxa de juros pode variar significativamente entre institui√ß√µes. Uma diferen√ßa de
            apenas 0,5% ao ano pode representar dezenas de milhares de reais em um financiamento de
            longo prazo. Use nossa calculadora para simular diferentes cen√°rios.
          </p>
        </div>
      </div>

      <div class="flex gap-4 items-start">
        <div class="text-3xl flex-shrink-0">üìã</div>
        <div>
          <h3 class="text-xl font-bold text-[#1F2937] mb-2">Mantenha seu cadastro limpo</h3>
          <p class="text-gray-700 leading-relaxed">
            Score de cr√©dito alto, CPF sem restri√ß√µes e comprova√ß√£o de renda est√°vel s√£o
            fundamentais para obter aprova√ß√£o e conseguir as melhores taxas. Consulte seu score
            regularmente e mantenha suas contas em dia.
          </p>
        </div>
      </div>

      <div class="flex gap-4 items-start">
        <div class="text-3xl flex-shrink-0">‚è≥</div>
        <div>
          <h3 class="text-xl font-bold text-[#1F2937] mb-2">Escolha o prazo adequado</h3>
          <p class="text-gray-700 leading-relaxed">
            Prazos mais longos resultam em parcelas menores, mas voc√™ pagar√° muito mais juros ao
            longo do tempo. O ideal √© encontrar um equil√≠brio: parcelas que caibam confortavelmente
            no or√ßamento (m√°ximo 30% da renda) no menor prazo poss√≠vel.
          </p>
        </div>
      </div>

      <div class="flex gap-4 items-start">
        <div class="text-3xl flex-shrink-0">üéØ</div>
        <div>
          <h3 class="text-xl font-bold text-[#1F2937] mb-2">
            Considere amortiza√ß√µes extraordin√°rias
          </h3>
          <p class="text-gray-700 leading-relaxed">
            Sempre que poss√≠vel, fa√ßa amortiza√ß√µes extraordin√°rias (pagamentos extras). Voc√™ pode
            optar por reduzir o prazo (manter a parcela e terminar mais cedo) ou reduzir a parcela
            (manter o prazo com parcelas menores). Ambas as op√ß√µes economizam juros.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Custos Adicionais -->
  <div class="bg-gradient-to-br from-purple-50 to-white rounded-2xl p-8 border border-gray-200">
    <h2 class="text-3xl font-bold text-[#1F2937] mb-6">Custos Adicionais no Financiamento</h2>
    <p class="text-gray-700 leading-relaxed mb-6">
      Al√©m das parcelas mensais, existem diversos custos envolvidos na compra de um im√≥vel
      financiado. √â importante consider√°-los no planejamento:
    </p>
    <div class="grid md:grid-cols-2 gap-6">
      <div class="border-2 border-gray-200 rounded-xl p-6">
        <h3 class="text-lg font-bold text-[#1F2937] mb-2">Taxas na Contrata√ß√£o</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-700 text-sm">
          <li><strong>Taxa de avalia√ß√£o:</strong> R$ 2.000 a R$ 4.000</li>
          <li><strong>Registro do im√≥vel:</strong> ~1% do valor do im√≥vel</li>
          <li><strong>ITBI:</strong> 2% a 3% do valor venal (varia por cidade)</li>
          <li><strong>Seguro MIP:</strong> 0,025% a 0,04% ao m√™s</li>
          <li><strong>Seguro DFI:</strong> R$ 500 a R$ 1.500/ano</li>
        </ul>
      </div>

      <div class="border-2 border-gray-200 rounded-xl p-6">
        <h3 class="text-lg font-bold text-[#1F2937] mb-2">Custos Mensais</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-700 text-sm">
          <li><strong>Parcela do financiamento</strong></li>
          <li><strong>Condom√≠nio:</strong> varia conforme o im√≥vel</li>
          <li><strong>IPTU:</strong> depende da cidade e valor do im√≥vel</li>
          <li><strong>Seguro inc√™ndio:</strong> geralmente obrigat√≥rio</li>
          <li><strong>Manuten√ß√£o e reparos</strong></li>
        </ul>
      </div>
    </div>
    <div class="mt-6 bg-yellow-100 border-l-4 border-yellow-500 p-4">
      <p class="text-sm text-yellow-900">
        <strong>Dica:</strong> Reserve pelo menos 10% a 15% a mais do valor da parcela para cobrir
        esses custos adicionais.
      </p>
    </div>
  </div>
</section>

<!-- Modal da Caixa -->
<app-caixa-info-modal
  [isOpen]="caixaModalAberto"
  (close)="fecharCaixaModal()"
  (selectLinhaEvent)="aplicarTaxaCaixa($event)"
>
</app-caixa-info-modal>
