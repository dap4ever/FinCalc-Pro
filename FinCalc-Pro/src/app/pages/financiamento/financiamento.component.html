<section class="space-y-6">
  <h1 class="text-2xl font-semibold text-[#1F2937]">Calculadora de Financiamento Imobili치rio</h1>
  <p class="text-gray-700">Simule parcelas, juros e valor total do financiamento</p>

  <form class="grid md:grid-cols-2 gap-6 bg-white p-6 rounded-2xl shadow-sm border border-gray-200" (ngSubmit)="simular()">
    <div>
      <label class="block text-sm text-gray-600 mb-1">Banco</label>
      <div class="relative">
        <button
          type="button"
          (click)="toggleDropdown()"
          class="w-full rounded-xl border border-gray-300 px-3 py-2.5 bg-white text-left flex items-center justify-between hover:border-[#2563EB] transition-colors"
        >
          <div class="flex items-center gap-3">
            <img
              *ngIf="getBancoSelecionado()?.logo"
              [src]="getBancoSelecionado()?.logo"
              [alt]="bancoSelecionado"
              class="h-6 w-auto object-contain p-1 bg-white rounded"
            />
            <span class="text-gray-900">{{ bancoSelecionado || 'Selecione um banco' }}</span>
          </div>
          <svg class="w-5 h-5 text-gray-400" [class.rotate-180]="dropdownAberto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        
        <div
          *ngIf="dropdownAberto"
          class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-xl shadow-lg max-h-80 overflow-auto"
        >
          <button
            *ngFor="let banco of bancos"
            type="button"
            (click)="selecionarBanco(banco.nome)"
            class="w-full px-3 py-3 text-left hover:bg-[#F9FAFB] flex items-center gap-3 transition-colors"
            [class.bg-blue-50]="banco.nome === bancoSelecionado"
          >
            <img
              *ngIf="banco.logo"
              [src]="banco.logo"
              [alt]="banco.nome"
              class="h-6 w-auto object-contain p-1 bg-gray-50 rounded"
              onerror="this.style.display='none'"
            />
            <div class="flex-1">
              <div class="font-medium text-gray-900">{{ banco.nome }}</div>
              <div *ngIf="banco.taxa > 0" class="text-xs text-gray-500">{{ banco.taxa.toFixed(2) }}% a.a.</div>
            </div>
          </button>
        </div>
      </div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Taxa de Juros Anual (%)</label>
      <input type="number" step="0.01" [(ngModel)]="jurosAnual" name="jurosAnual" class="w-full rounded-xl border border-gray-300 px-3 py-2" placeholder="Ex: 9.5%" />
      <div class="mt-1 text-xs text-gray-500" *ngIf="!carregandoTaxas">
        Taxa m칠dia atual: <strong class="text-[#2563EB]">{{ taxaSugerida.toFixed(2) }}% a.a.</strong>
        <button type="button" (click)="aplicarTaxaSugerida()" class="ml-2 text-[#2563EB] hover:underline">Aplicar</button>
      </div>
      <div class="mt-1 text-xs text-gray-400" *ngIf="carregandoTaxas">Carregando taxa atual...</div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Valor do Im칩vel</label>
      <div class="relative">
        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-600 font-medium">R$</span>
        <input type="text" appCurrencyMask [(ngModel)]="valorImovel" name="valorImovel" (ngModelChange)="onValorImovelChange()" class="w-full rounded-xl border border-gray-300 pl-12 pr-3 py-2" placeholder="300.000,00" />
      </div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Valor da Entrada</label>
      <div class="relative">
        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-600 font-medium">R$</span>
        <input type="text" appCurrencyMask [(ngModel)]="entrada" name="entrada" class="w-full rounded-xl border border-gray-300 pl-12 pr-3 py-2" placeholder="60.000,00" />
      </div>
      <div class="mt-1 text-xs text-gray-500" *ngIf="percentualEntradaMinima > 0">
        Entrada m칤nima: <strong class="text-[#2563EB]">{{ percentualEntradaMinima }}%</strong> ({{ entradaMinimaRecomendada | currency:'BRL':'symbol':'1.2-2':'pt-BR' }})
      </div>
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Prazo (anos)</label>
      <input type="number" [(ngModel)]="prazoAnos" name="prazoAnos" (focus)="$event.target.select()" class="w-full rounded-xl border border-gray-300 px-3 py-2" placeholder="Ex: 30 anos" />
    </div>
    <div>
      <label class="block text-sm text-gray-600 mb-1">Sistema de Amortiza칞칚o</label>
      <select [(ngModel)]="sistema" name="sistema" class="w-full rounded-xl border border-gray-300 px-3 py-2">
        <option value="SAC">SAC</option>
        <option value="PRICE">PRICE</option>
      </select>
    </div>

    <div class="md:col-span-2 flex justify-end">
      <button type="submit" class="rounded-xl bg-[#2563EB] text-white px-5 py-3 shadow-md hover:bg-[#1E4FD7]">Simular</button>
    </div>
  </form>

  <div *ngIf="resultado as r" class="mt-8">
    <div class="rounded-2xl bg-white p-8 shadow-sm border border-gray-200 max-w-2xl">
      <h3 class="text-xl font-semibold mb-6 text-[#1F2937] pb-3 border-b-2 border-gray-200">Resultado da Simula칞칚o</h3>
      <ul class="space-y-5">
        <li class="flex justify-between items-center py-3">
          <span class="text-base text-gray-600">Valor da Parcela Inicial</span>
          <strong class="text-xl text-[#1F2937]">{{ r.parcelaInicial }}</strong>
        </li>
        <li class="flex justify-between items-center py-3 bg-gray-50 -mx-4 px-4 rounded-lg">
          <span class="text-base text-gray-600">Valor da Parcela Final</span>
          <strong class="text-xl text-[#1F2937]">{{ r.parcelaFinal }}</strong>
        </li>
        <li class="flex justify-between items-center py-3">
          <span class="text-base text-gray-600">Valor Total Pago</span>
          <strong class="text-xl text-[#1F2937]">{{ r.valorTotalPago }}</strong>
        </li>
        <li class="flex justify-between items-center py-3 bg-gray-50 -mx-4 px-4 rounded-lg">
          <span class="text-base text-gray-600">Total de Juros</span>
          <strong class="text-xl text-[#1F2937]">{{ r.totalJuros }}</strong>
        </li>
      </ul>
    </div>

    <!-- An칰ncio ap칩s resultado -->
    <div class="mt-8 rounded-2xl bg-white p-8 shadow-sm border-2 border-dashed border-gray-300 max-w-2xl flex items-center justify-center min-h-[300px]">
      <div class="text-center">
        <div class="text-5xl mb-3">游닉</div>
        <p class="text-gray-500 text-lg">Espa칞o para An칰ncio</p>
        <p class="text-gray-400 text-sm mt-2">Ap칩s resultado da simula칞칚o</p>
      </div>
    </div>
  </div>
</section>
